<!doctype html>
<html>
<head><meta charset="utf-8"><title>Passordgenerator</title></head>
<body>
  <h3>Passordgenerator</h3>
  <label>Lengde: <input id="len" type="number" value="6" min="1" max="256"></label><br>
  <label>Store/små/ Begge:
    <select id="case">
      <option value="both">Begge</option>
      <option value="lower">Bare små</option>
      <option value="upper">Bare store</option>
    </select>
  </label><br>
  <label><input id="special" type="checkbox" checked> Tillat spesialtegn</label><br>
  <button id="gen">Generer</button>
  <p>Passord: <code id="out"></code></p>

  <script>
    // Lim inn generatePassword og avhengige funksjoner her (fra passordgenerator.js)
    const CHAR_SETS = {
      lower: 'abcdefghijklmnopqrstuvwxyz',
      upper: 'ABCDEFGHIJKLMNOPQRSTUVWXYZ',
      digits: '0123456789',
      special: '!@#$%^&*()-_=+[]{}|;:,.<>?/~`'
    };

    function getCharset({ useLower, useUpper, useDigits = true, useSpecial }) {
      let chars = '';
      if (useLower) chars += CHAR_SETS.lower;
      if (useUpper) chars += CHAR_SETS.upper;
      if (useDigits) chars += CHAR_SETS.digits;
      if (useSpecial) chars += CHAR_SETS.special;
      return chars;
    }

    function secureRandomInt(max) {
      const array = new Uint32Array(1);
      const limit = Math.floor(0xFFFFFFFF / max) * max;
      let r;
      do {
        crypto.getRandomValues(array);
        r = array[0];
      } while (r >= limit);
      return r % max;
    }

    function generatePassword(options) {
      const length = Number(options.length) || 12;
      if (!Number.isInteger(length) || length <= 0) {
        throw new Error('Lengde må være et positivt heltall');
      }

      let useLower = false;
      let useUpper = false;
      if (options.case === 'lower') useLower = true;
      else if (options.case === 'upper') useUpper = true;
      else useLower = useUpper = true;

      const charset = getCharset({
        useLower,
        useUpper,
        useDigits: true,
        useSpecial: Boolean(options.allowSpecial)
      });

      if (!charset) throw new Error('Ingen gyldige tegn valgt for passordet');

      let pwd = '';
      for (let i = 0; i < length; i++) {
        const idx = secureRandomInt(charset.length);
        pwd += charset[idx];
      }

      return pwd;
    }

    document.getElementById('gen').addEventListener('click', () => {
      try {
        const length = parseInt(document.getElementById('len').value, 10);
        const kase = document.getElementById('case').value;
        const allowSpecial = document.getElementById('special').checked;
        const pwd = generatePassword({ length, case: kase, allowSpecial });
        document.getElementById('out').textContent = pwd;
      } catch (e) {
        document.getElementById('out').textContent = 'Feil: ' + e.message;
      }
    });
  </script>
</body>
</html>
